#Web-calculator

Библиотека представлет собой инструмент для встраивания на веб-страницу виджета **калькулятор**

##Описание

###Поля

Все элементы калькулятора - это HTML теги (**input** или **select**), с указанным аттрибутом **data-calc**.

Например:
```html
<div data-calc="MAIN">
	<!-- поля калькулятора -->
	<div>
		<input data-calc="field1">
		<input data-calc="field2">
		...
		<input data-calc="fieldN">
	</div>
	<!-- вывод результата -->
	<div>
		<input data-calc="OUTPUT">
	</div>
	<!-- кнопка начала вычислений -->
	<div>
		<input type='button' onclick='Calculator.exec()'>
	</div>
</div>
```
где *field1, field2, ...* - имена полей калькулятора.

На имена полей накладываются ограничения:
- не число (допустимы имена вида: "13a", "x3", "11iL2", ...)
- не [ключевое слово](#Ключевые-слова)

Последним полем в примере является кнопка при нажатии на которую происходит вычисление результата по указанной [формуле](#Формула).

###Формула

Для того чтобы калькулятор знал каким образом производить вычисления, необходимо перегрузить метод **formula** в главном объекте.

Например:
```javascript
Calculator.formula = function() {
	var x = op("field2").sub(123);
	return op(2).add(3).multy("field1").div(2).sub(x);
}
```
Функция должна возвращать элемент типа [Operand](#Операнды).

###Операнды

Формула состоит из операндов. Каждый операнд это экземпляр класса **Operand**. Создавать экземпляры можно двумя способами:

```javascript
var x = new Operand(1);
var x = op(1);
```

Оба варианта рабочие, но естественно что удобнее использовать второй.

Входным значением для конструктора **Operand**, а также для **функций-операций** может быть:
- операнд (Operand)
- число (Number)
- имя поля (String)

Объект **Operand** представляет собой **неизменяемый** объект, т.е. значение задается в нем только **один раз** при инциализации. Все операции производимые над объектом, **пораждают новый объект**:
```javascript
var x = op(3);
var y = x.add(12);

//
// Получить значение можно с помощью функции val()
//
x.val(); // =3
y.val(); // =15
```

Ниже приведен пример с использованием всех доступных операций (никто не мешает добавить своих путем добавления методов к классу **Operand**):
```javascript
Calculator.formula = function() {
	//
	// ПРОСТЫЕ ОПЕРАТОРЫ
	//
	
	// инициализация
	var x1 = op(0);
	var x2 = op("field1");
	var x3 = op(x2); // так тоже можно, но не понятно зачем :-)
	// сложение
	x1.add(1);
	// вычитание
	x1.sub(x2);
	// умножение
	x1.multy("field2");
	// деление
	x2.div(x1);
	// возведение в степень
	x3.pow(x1);
	// можно выстраивать цепочки вычислений, выражение ниже равносильно: x1 = x1 * x2 - x3
	x1 = x1.multy(x2).sub(x3);
	
	//
	// ГРУППОВЫЕ ОПЕРАТОРЫ
	//
	
	// суммирование
	var x = Operand.sum([x1, 23, "field3"]);
	// равносильно
	var x = op(x1).add(23).add("field3");
	
	// произведение
	var x = Operand.multymany([x2, 45, "field4"]);
	// равносильно
	var x = op(x2).multy(45).multy("field4");
	
	//
	// Куб суммы: a^3 + 3*(a^2)*b + 3*a*(b^2) + b^3
	//
	var a = op("a");
	var b = op("b");
	Operand.multymany([
		a.pow(3),
		Operand.multymany([a.pow(2), 3, b]),
		Operand.multymany([b.pow(2), 3, a]),
		b.pow(3)
	]);
}
```

###Правила

Правила - это функции, которые выполняются перед тем как вернуть значение поля. Установка правил производиться присвоением функции к соответствующему полю главнного класса.

Например:
```javascript
Calculator.rules["field1"] = function(value) {
	return (value >= 10) ? 10 : value;
}

// допустим значение поля 'field1' равно '6'
var x = op("field1").val(); // x = 6
// допустим значение поля 'field1' равно '13'
var x = op("field1").val(); // x = 10
```

В правилах можно использовать значения других полей. Например, в книжнем магазине, при покупке свыше 5 книг клиент получает скидку 20%, а при покупке 10 книг - 50%. Данное условие можно реализовать с помощью правила:

```javascript
//
// имеем два поля: "count" - число книг и "cost" - цена за 1 книгу
//
Calculator.formula = function() {
	return op("cost").multy("count");
	// равносильно
	return Operand.multymany(["cost", "count"]);
}

Calculator.rules["cost"] = function(value) {
	var count = this.fields["count"];
	var k = 1.0;
	if (count >= 5) {
		k = 0.8;
	}
	if (count >= 10) {
		k = 0.5;
	}
	return value * k;
}
```

###Ключевые слова

Всего их два и предназначены они для служебных целей (регистр ВАЖЕН):
- **MAIN** - определяет области калькулятора, среди потомков данного тега производиться поиск [полей калькулятора](#Поля).
- **OUTPUT** - определяет куда будет выводиться результат вычислений. Может быть любым тегом имеющим JS свойства **value** или **innerHTML**. Данный тег можно не указывать, тогда результат будет отображен во всплывающем окне **alert**.
