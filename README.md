#Web-calculator

Библиотека представлет собой инструмент для встраивания на веб-страницу виджета **калькулятор**

##Описание

###Поля

Все элементы калькулятора - это HTML теги (**input** или **select**), с указанным аттрибутом **data-calc**.

Например:
```html
<div data-calc="MAIN">
	<!-- поля калькулятора -->
	<div>
		<input data-calc="field1">
		<input data-calc="field2">
		...
		<input data-calc="fieldN">
	</div>
	<!-- вывод результата -->
	<div>
		<input data-calc="OUTPUT">
	</div>
	<!-- кнопка начала вычислений -->
	<div>
		<input type='button' onclick='Calculator.exec()'>
	</div>
</div>
```
где *field1, field2, ...* - имена полей калькулятора.

На имена полей накладываются ограничения:
- не число (допустимы имена вида: "13a", "x3", "11iL2", ...)
- не [ключевое слово](#Ключевые-слова)

Последним полем в примере является кнопка при нажатии на которую происходит вычисление результата по указанной [формуле](#Формула).

###Формула

Для того чтобы калькулятор знал каким образом производить вычисления, необходимо перегрузить метод **formula** в главном объекте.

Например:
```javascript
Calculator.formula = function() {
	var x = new Operand("field2").sub(123);
	return new Operand(2).add(3).multy("field1").div(2).sub(x);
}
```
Функция должна возвращать элемент типа **Operand**, иначе результатом вычисления будет **NaN**. Входным значением для функций-операций может быть:
- операнд (Operand)
- число (Number)
- имя поля (String)

Ниже приведен пример с использованием всех доступных операций (никто не мешает добавить своих путем добавления методов к классу **Operand**):
```javascript
Calculator.formula = function() {
	//
	// ПРОСТЫЕ ОПЕРАТОРЫ
	//
	
	// инициализация
	var x1 = new Operand(0);
	var x2 = new Operand("field1");
	var x3 = new Operand(x2); // так тоже можно, но не понятно зачем :-)
	// сложение
	x1.add(1);
	// вычитание
	x1.sub(x2);
	// умножение
	x1.multy("field2");
	// деление
	x2.div(x1);
	// возведение в степень
	x3.pow(x1);
	// можно выстраивать цепочки вычислений, выражение ниже равносильно: x1 = x1 * x2 - x3
	x1.multy(x2).sub(x3);
	
	//
	// ГРУППОВЫЕ ОПЕРАТОРЫ
	//
	
	// суммирование
	var x = Operand.sum([x1, 23, "field3"]);
	// равносильно
	var x = (new Operand(x1)).add(23).add("field3");
	
	// произведение
	var x = Operand.multymany([x2, 45, "field4"]);
	// равносильно
	var x = (new Operand(x2)).multy(45).multy("field4");
	
	//
	// Куб суммы: a^3 + 3*(a^2)*b + 3*a*(b^2) + b^3
	//
	Operand.multymany([
		(new Operand("a")).pow(3),
		Operand.multymany([
			3,
			(new Operand("a")).pow(2),
			"b"
		]),
		Operand.multymany([
			3,
			"a",
			(new Operand("b")).pow(2),
		]),
		(new Operand("b")).pow(3),
	]);
}
```

**WARNING:** все операции изменяют исходный объект!

```javascript
x = new Operand(3);
x.value; // =3
x.add(12);
x.value; // =15
```

###Правила

Правила - это функции, которые выполняются перед тем как вернуть значение поля. Установка правил производиться присвоением функции к соответствующему полю главнного класса.

Например:
```javascript
Calculator.rules["field1"] = function(value) {
	return (value >= 10) ? 10 : value;
}

// допустим значение поля 'field1' равно '6'
var x = (new Operand("field1")).value; // x = 6
// допустим значение поля 'field1' равно '13'
var x = (new Operand("field1")).value; // x = 10
```

Для одного поля можно применять **несколько** правил (смысл этого не понятен, но мало ли), но вызываются они все строго в порядке инициализации.

Например:
```javascript
Calculator.rules["field1"] = function(value) {
	// rule1
}

Calculator.rules["field1"] = function(value) {
	// rule2
}
```
При инициализации значений к полю "field1" будет применено сначало "rule1" затем "rule2".

В правилах можно использовать значения других полей. Например, в книжнем магазине, при покупке свыше 5 книг клиент получает скидку 20%, а при покупке 10 книг - 50%. Данное условие можно реализовать с помощью правила:

```javascript
//
// имеем два поля: "count" - число книг и "cost" - цена за 1 книгу
//
Calculator.formula = function() {
	// return new Operand("cost").multy("count");
	return Operand.multymany(["cost", "count"]);
}

Calculator.rules["cost"] = function(value) {
	var count = this.fields["count"];
	var k = 1.0;
	if (count >= 5) {
		k = 0.8;
	}
	if (count >= 10) {
		k = 0.5;
	}
	return value * k;
}
```

###Ключевые слова

Всего их два и предназначены они для служебных целей (регистр ВАЖЕН):
- **MAIN** - определяет области калькулятора, среди потомков данного тега производиться поиск [полей калькулятора](#Поля).
- **OUTPUT** - определяет куда будет выводиться результат вычислений. Может быть любым тегом имеющим JS свойства **value** или **innerHTML**. Данный тег можно не указывать, тогда результат будет отображен во всплывающем окне **alert**.

##Доработать

###Более сокращенный вариант создания переменных

- Укороченный конструктор:
```javascript
function op(val) {
	return new Operand(val);
}
```

###Более сокращенный вариант выполнения операций
